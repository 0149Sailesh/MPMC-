ORG 0
MOV DPTR,#MYCOM
CLR A
MOV P1,A
MOV R0,#1
C1:CLR A
MOVC A,@A+DPTR
ACALL COMNWRT
ACALL  DELAY
INC DPTR
JZ DETERGENT
SJMP C1

DETERGENT: JNB P0.0,DETERGENT ;DETERGENT
CONFIRM: JNB P0.1,CONFIRM ;CONFIRM
SETB P1.7 ;DOOR IS CLOSED HERE


JB P0.2,ODD ;EITHER MODE 1 OR MODE 3 LSB bit

EVEN:
JB P0.3,MODE2
SJMP MODE0

ODD:
JB P0.3,MODE3 ;MODE 3 JUMP P2.6 is MSB
SJMP MODE1

MODE0:	 ;NORMAL WASH 4 sec
MOV DPTR,#TEXT0
ACALL DAT
SJMP WATERIN

MODE1:	  ;WASH AND RINSE 6sec
MOV DPTR,#TEXT1
ACALL DAT
SJMP WATERIN
ACALL DAT

MODE2:	  ;SPIN	 2sec
MOV DPTR,#TEXT2
ACALL DAT
SJMP MOTORFAST
ACALL DAT

MODE3:	   ;HOT WATER WASH 4 sec
MOV DPTR,#TEXT3
ACALL DAT
SETB P1.2
SJMP WATERIN

;WATER IN CODE STARTS HERE
WATERIN:

SETB P1.6

JB P0.5,ODD1 ;EITHER MODE 1 OR MODE 3 LSB bit

EVEN1:
JB P0.6,DELAY2
SJMP DELAY0

ODD1:
JB P0.6,DELAY3 ;MODE 3 JUMP P2.6 is MSB
SJMP DELAY1

;DECODE COMMON BLOCKS


DELAY0:
ACALL TDELAY
SJMP MOTORSLOW
DELAY1:
ACALL TDELAY
ACALL TDELAY
SJMP MOTORSLOW

DELAY2:
ACALL TDELAY
ACALL TDELAY
ACALL TDELAY
SJMP MOTORSLOW

DELAY3:
ACALL TDELAY
ACALL TDELAY
ACALL TDELAY
ACALL TDELAY
SJMP MOTORSLOW

;WATER IN CODE ENDS HERE
;MOTORSLOW STARTS HERE
MOTORSLOW:;
CLR P1.6
SETB P1.5

JB P0.5,ODD2 ;EITHER MODE 1 OR MODE 3 LSB bit

EVEN2:
JB P0.6,DELAY2SLOW
SJMP DELAY0SLOW

ODD2:
JB P0.6,DELAY3SLOW ;MODE 3 JUMP P2.6 is MSB
SJMP DELAY1SLOW

;DECODE COMMON BLOCKS


DELAY0SLOW:
ACALL TDELAY
SJMP MOTORFAST
DELAY1SLOW:
ACALL TDELAY
ACALL TDELAY
SJMP MOTORFAST

DELAY2SLOW:
ACALL TDELAY
ACALL TDELAY
ACALL TDELAY
SJMP MOTORFAST

DELAY3SLOW:
ACALL TDELAY
ACALL TDELAY
ACALL TDELAY
ACALL TDELAY
SJMP MOTORFAST

MOTORFAST:
CLR P1.5
SETB P1.4

JB P0.5,ODD3 ;EITHER MODE 1 OR MODE 3 LSB bit

EVEN3:
JB P0.6,DELAY2FAST
SJMP DELAY0FAST

ODD3:
JB P0.6,DELAY3FAST ;MODE 3 JUMP P2.6 is MSB
SJMP DELAY1FAST

;DECODE COMMON BLOCKS


DELAY0FAST:
ACALL TDELAY
SJMP WATERDRAIN
DELAY1FAST:
ACALL TDELAY
ACALL TDELAY
SJMP WATERDRAIN

DELAY2FAST:
ACALL TDELAY
ACALL TDELAY
ACALL TDELAY
SJMP WATERDRAIN

DELAY3FAST:
ACALL TDELAY
ACALL TDELAY
ACALL TDELAY
ACALL TDELAY
SJMP WATERDRAIN


WATERDRAIN:
CLR P1.4
SETB P1.3
ACALL TDELAY
ACALL TDELAY
CLR P1.3

JB P0.2,ODD4

INF: SJMP INF ;CHANGE TO TIMER CODE

ODD4:
JNB P0.3,REPEAT

INF1:SJMP INF1 ;CHANGE TO TIMER CODE

REPEAT:
 DEC R0
 CJNE R0,#0,NEXT
 LJMP WATERIN
NEXT:
INF3: SJMP INF3
 ;REMOVEEEE MUST!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
TDELAY:
MOV R5,#255
H3: MOV R4,#255
H2: MOV R3,#7
H1: DJNZ R3,H1
	DJNZ R4,H2
	DJNZ R5,H3
	RET

;LCD STUFF STARTS HERE
DAT:
ACALL SEND_DAT
MOV A,#0C0H
ACALL COMNWRT 
ACALL DELAY
SJMP TDELAY
SJMP TDELAY
SJMP TDELAY
RET


SEND_DAT:

D1:CLR A
MOVC A,@A+DPTR
ACALL DATAWRT
ACALL DELAY
INC DPTR
JZ AGAIN
SJMP D1
AGAIN: RET



COMNWRT:MOV P3,A
CLR P2.0
CLR P2.1
SETB P2.2
ACALL DELAY
CLR P2.2
RET

DATAWRT: MOV P3,A
SETB P2.0
CLR P2.1
SETB P2.2
ACALL DELAY
CLR P2.2
RET

DELAY: MOV R3,#228
HERE: DJNZ R4,HERE
RET
THEEND:
;LCD STUFF ENDS HERE
ORG 300H
MYCOM: DB 38H,0EH,01,06,80H,0
STRING: DB "Electronics and ",0
TEXT0: DB "Mode zero",0
TEXT1: DB "Mode one",0
TEXT2: DB "Mode two",0
TEXT3: DB "Mode three",0
END